<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üéÆ –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="game-container">
    <h1>üéÆ –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100!</h1>
    <p class="subtitle">–£ —Ç–µ–±—è –µ—Å—Ç—å 7 –ø–æ–ø—ã—Ç–æ–∫. –ü–æ–ø—Ä–æ–±—É–π —É–≥–∞–¥–∞—Ç—å –∑–∞–≥–∞–¥–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ!</p>

    <div class="input-group">
      <input type="number" id="userGuess" min="1" max="100" placeholder="–í–≤–µ–¥–∏ —á–∏—Å–ª–æ" />
      <button id="submitGuess">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    </div>

    <div id="message" class="message"></div>
    <div id="attempts" class="attempts">–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: 7</div>
    <button id="restart" class="restart-btn" style="display: none;">üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
  </div>

  <script>
    let gameOver = false;

    const userGuessInput = document.getElementById('userGuess');
    const submitButton = document.getElementById('submitGuess');
    const messageDiv = document.getElementById('message');
    const attemptsDiv = document.getElementById('attempts');
    const restartButton = document.getElementById('restart');

    function updateAttemptsDisplay(attemptsLeft) {
      attemptsDiv.textContent = `–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: ${attemptsLeft}`;
    }

    function showMessage(text, color) {
      messageDiv.textContent = text;
      messageDiv.style.color = color;
      messageDiv.classList.remove('show');
      setTimeout(() => {
        messageDiv.classList.add('show');
      }, 10);
    }

    async function startNewGame() {
      try {
        const response = await fetch('/api/start');
        const data = await response.json();
        gameOver = false;
        updateAttemptsDisplay(data.attemptsLeft);
        showMessage('–ù–æ–≤–∞—è –∏–≥—Ä–∞ –Ω–∞—á–∞—Ç–∞!', '#ffffff');
        restartButton.style.display = 'none';
        userGuessInput.value = '';
        userGuessInput.focus();
      } catch (err) {
        showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏–≥—Ä—ã.', '#ff9800');
      }
    }

    async function checkGuess() {
      if (gameOver) return;

      const userGuess = userGuessInput.value;

      try {
        const response = await fetch('/api/guess', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ guess: userGuess })
        });

        const result = await response.json();

        if (result.status === 'invalid') {
          showMessage(result.message, '#ff9800');
          return;
        }

        if (result.status === 'win') {
          showMessage(result.message, '#4caf50');
          gameOver = true;
          restartButton.style.display = 'inline-block';
          document.body.style.background = 'linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%)';
        } else if (result.status === 'lose') {
          showMessage(result.message, '#f44336');
          gameOver = true;
          restartButton.style.display = 'inline-block';
          document.body.style.background = 'linear-gradient(135deg, #f44336 0%, #ff9800 100%)';
        } else if (result.status === 'low' || result.status === 'high') {
          showMessage(result.message, '#2196F3');
        }

        updateAttemptsDisplay(result.attemptsLeft);
        userGuessInput.value = '';
        userGuessInput.focus();

      } catch (err) {
        showMessage('–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º.', '#ff9800');
      }
    }

    submitButton.addEventListener('click', checkGuess);

    userGuessInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        checkGuess();
      }
    });

    restartButton.addEventListener('click', startNewGame);

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    startNewGame();
  </script>
</body>
</html>